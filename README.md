# Makefile for the System Health Monitor Kernel Module

# Specify the name of the module object file (without .o)
# This should match your .c file name (e.g., sys_health_monitor.c)
MODULE_NAME=sys_health_monitor

# Tell kbuild the name of the final module object(s) to build.
# It expects a list of objects based on the source files.
# For a single source file like sys_health_monitor.c, this becomes:
obj-m := $(MODULE_NAME).o

# Path to the kernel source/build directory.
# Uses the build directory associated with the currently running kernel by default.
# This directory contains the necessary headers and configuration.
KDIR := /lib/modules/$(shell uname -r)/build

# PWD is the current working directory (where this Makefile resides).
PWD := $(shell pwd)

# Default target executed when you just run 'make'.
# This command tells make to change to the kernel build directory (-C $(KDIR))
# and then build modules located in the directory specified by M=$(PWD).
all:
	$(MAKE) -C $(KDIR) M=$(PWD) modules

# Target to clean up build artifacts generated by the compilation process.
# This includes the .ko file, .o file, .mod.c file, etc.
clean:
	$(MAKE) -C $(KDIR) M=$(PWD) clean

# Target to install the compiled module into the standard kernel module directory.
# This typically requires root privileges.
install: all
	$(MAKE) -C $(KDIR) M=$(PWD) modules_install

# Target to remove the installed module from the system directory.
# This also typically requires root privileges and updates module dependencies.
uninstall:
	rm -f /lib/modules/$(shell uname -r)/extra/$(MODULE_NAME).ko
	depmod -a

# Declare targets that are not actual files to prevent make from getting confused
# if files with these names happen to exist.
.PHONY: all clean install uninstall
